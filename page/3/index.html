<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Seite 3 | darion.johannes.yaphet</title>
  <meta name="author" content="Darion Yaphet">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="darion.johannes.yaphet"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="darion.johannes.yaphet" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">darion.johannes.yaphet</a></h1>
  <h2><a href="/">long is the way and hard  that out of Hell leads up to light</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-03T14:32:16.000Z"><a href="/2016/09/03/machine_learning/RidgeRegression/">2016-09-03</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/03/machine_learning/RidgeRegression/"></a></h1>
  

    </header>
    <div class="entry">
      
        
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-03T13:14:12.000Z"><a href="/2016/09/03/machine_learning/NaiveBayes/">2016-09-03</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/03/machine_learning/NaiveBayes/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="Naive-Bayes-朴素贝叶斯"><a href="#Naive-Bayes-朴素贝叶斯" class="headerlink" title="Naive Bayes(朴素贝叶斯)"></a>Naive Bayes(朴素贝叶斯)</h3><h4 id="Bayes’-theorem-贝叶斯定理"><a href="#Bayes’-theorem-贝叶斯定理" class="headerlink" title="Bayes’ theorem (贝叶斯定理)"></a>Bayes’ theorem (贝叶斯定理)</h4><p>贝叶斯定理用来描述两个条件概率之间的关系，比如 P(A|B) 和 P(B|A)。</p>
<p>按照乘法法则，可以立刻导出：P(A∩B) = P(A) <em> P(B|A) = P(B) </em> P(A|B)。</p>
<p>如上公式也可变形为：P(B|A) = P(A|B) * P(B) / P(A)。</p>
<hr>
<p>Reference :</p>
<ol>
<li><p><a href="https://zh.wikipedia.org/wiki/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8" target="_blank" rel="external">朴素贝叶斯分类器</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2013/12/naive_bayes_classifier.html" target="_blank" rel="external">朴素贝叶斯分类器的应用</a></p>
</li>
<li><p><a href="http://scikit-learn.org/stable/modules/naive_bayes.html" target="_blank" rel="external">Naive Bayes</a></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-08-28T11:44:39.000Z"><a href="/2016/08/28/algorithms/Kosaraju/">2016-08-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/28/algorithms/Kosaraju/"></a></h1>
  

    </header>
    <div class="entry">
      
        
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-08-26T16:00:00.000Z"><a href="/2016/08/27/algorithms/Graph/">2016-08-27</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/27/algorithms/Graph/">Graph</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h3><h5 id="深度优先搜索"><a href="#深度优先搜索" class="headerlink" title="深度优先搜索"></a>深度优先搜索</h5><h5 id="广度优先搜索"><a href="#广度优先搜索" class="headerlink" title="广度优先搜索"></a>广度优先搜索</h5><hr>
<p>Reference :</p>
<ol>
<li><a href=""></a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-08-13T16:00:00.000Z"><a href="/2016/08/14/distribution/yarn/">2016-08-14</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/14/distribution/yarn/">Yarn</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h2><h3 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h3><p><code>Yarn</code> (Yet Another Resource Negotiator) 是一种通用资源管理系统，可为上层应用提供统一资源管理和调度，它的引入为集群在利用率、资源统一管理和数据共享等方面带来了巨大提升。</p>
<p>The fundamental idea of Yarn is to split up the two major functionalities of the <code>JobTracker</code>, resource management and job scheduling/monitoring into separate daemons. </p>
<p>The idea is to have a global ResourceManager and per-application ApplicationMaster. </p>
<p>The <code>ResourceManager</code> and per-node slave, the <code>NodeManager</code>, form the data-computation framework. </p>
<p>The ResourceManager is the ultimate authority that arbitrates resources among all the applications in the system.</p>
<p>The per-application ApplicationMaster is, in effect, a framework specific library and is tasked with negotiating resources from the ResourceManager and working with the NodeManager(s) to execute and monitor the tasks.</p>
<p>The ResourceManager has two main components: Scheduler and ApplicationsManager.</p>
<p>The Scheduler is responsible for allocating resources to the various running applications subject to familiar constraints of capacities, queues etc. The Scheduler is pure scheduler in the sense that it performs no monitoring or tracking of status for the application. Also, it offers no guarantees about restarting failed tasks either due to application failure or hardware failures. The Scheduler performs its scheduling function based the resource requirements of the applications; it does so based on the abstract notion of a resource Container which incorporates elements such as memory, cpu, disk, network etc. In the first version, only memory is supported.</p>
<p>The Scheduler has a pluggable policy plug-in, which is responsible for partitioning the cluster resources among the various queues, applications etc. The current Map-Reduce schedulers such as the CapacityScheduler and the FairScheduler would be some examples of the plug-in.</p>
<p>The CapacityScheduler supports hierarchical queues to allow for more predictable sharing of cluster resources</p>
<p>The ApplicationsManager is responsible for accepting job-submissions, negotiating the first container for executing the application specific ApplicationMaster and provides the service for restarting the ApplicationMaster container on failure.</p>
<p>The NodeManager is the per-machine framework agent who is responsible for containers, monitoring their resource usage (cpu, memory, disk, network) and reporting the same to the ResourceManager/Scheduler.</p>
<p>The per-application ApplicationMaster has the responsibility of negotiating appropriate resource containers from the Scheduler, tracking their status and monitoring for progress.</p>
<p>MRV2 maintains API compatibility with previous stable release (hadoop-1.x). This means that all Map-Reduce jobs should still run unchanged on top of MRv2 with just a recompile.</p>
<h3 id="Yarn-状态转换图生成方法"><a href="#Yarn-状态转换图生成方法" class="headerlink" title="Yarn 状态转换图生成方法"></a>Yarn 状态转换图生成方法</h3><p>Yarn中ResourceManager，NodeManager几个组建的状态变迁使用的是有限状态机。</p>
<ol>
<li><code>mvn compile -Pvisualize   生成多个.gv文件</code></li>
<li><p>确保安装了graphviz   然后执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dot -Tpng NodeManager.gv &gt; NodeManager.png</span><br><span class="line">dot -Tpng ResourceManager.gv &gt;ResourceManager.png</span><br><span class="line">dot -Tpng MapReduce.gv &gt; MapReduce.png</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h3><p>RM是一个全局的资源管理器，负责整个系统的资源管理和分配。它主要由两个组件构成：调度器（Scheduler）和应用程序管理器（Applications Manager，ASM）。</p>
<h3 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h3><h3 id="ApplicationsManager"><a href="#ApplicationsManager" class="headerlink" title="ApplicationsManager"></a>ApplicationsManager</h3><h3 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">bin/yarn</span><br><span class="line">Usage: yarn [--config confdir] [COMMAND | CLASSNAME]</span><br><span class="line">  CLASSNAME                             run the class named CLASSNAME</span><br><span class="line"> or</span><br><span class="line">  where COMMAND is one of:</span><br><span class="line">  resourcemanager -format-state-store   deletes the RMStateStore</span><br><span class="line">  resourcemanager                       run the ResourceManager</span><br><span class="line">  nodemanager                           run a nodemanager on each slave</span><br><span class="line">  timelineserver                        run the timeline server</span><br><span class="line">  rmadmin                               admin tools</span><br><span class="line">  sharedcachemanager                    run the SharedCacheManager daemon</span><br><span class="line">  scmadmin                              SharedCacheManager admin tools</span><br><span class="line">  version                               print the version</span><br><span class="line">  jar &lt;jar&gt;                             run a jar file</span><br><span class="line">  application                           prints application(s)</span><br><span class="line">                                        report/kill application</span><br><span class="line">  applicationattempt                    prints applicationattempt(s)</span><br><span class="line">                                        report</span><br><span class="line">  container                             prints container(s) report</span><br><span class="line">  node                                  prints node report(s)</span><br><span class="line">  queue                                 prints queue information</span><br><span class="line">  logs                                  dump container logs</span><br><span class="line">  classpath                             prints the class path needed to</span><br><span class="line">                                        get the Hadoop jar and the</span><br><span class="line">                                        required libraries</span><br><span class="line">  cluster                               prints cluster information</span><br><span class="line">  daemonlog                             get/set the log level for each</span><br><span class="line">                                        daemon</span><br><span class="line"></span><br><span class="line">Most commands print help when invoked w/o parameters.</span><br></pre></td></tr></table></figure>
<p><code>yarn application [options]</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">COMMAND_OPTIONS</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-appStates <states></states></td>
<td style="text-align:left">filter applications based on input comma-separated list of application states.</td>
</tr>
<tr>
<td style="text-align:left">-appTypes <types></types></td>
<td style="text-align:left">filter applications based on input comma-separated list of application types.</td>
</tr>
<tr>
<td style="text-align:left">-list</td>
<td style="text-align:left">Lists applications from the RM. </td>
</tr>
<tr>
<td style="text-align:left">-kill <applicationid></applicationid></td>
<td style="text-align:left">Kills the application.</td>
</tr>
<tr>
<td style="text-align:left">-status <applicationid></applicationid></td>
<td style="text-align:left">Prints the status of the application.</td>
</tr>
</tbody>
</table>
<p><code>yarn applicationattempt [options]</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">COMMAND_OPTIONS</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-list <applicationid></applicationid></td>
<td style="text-align:left">Lists applications attempts for the given application.</td>
</tr>
<tr>
<td style="text-align:left">-status <application attempt="" id=""></application></td>
<td style="text-align:left">Prints the status of the application attempt.</td>
</tr>
</tbody>
</table>
<p><code>yarn classpath</code></p>
<p>Prints the class path needed to get the Hadoop jar and the required libraries</p>
<p><code>yarn container [options]</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">COMMAND_OPTIONS</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-list <application attempt="" id=""></application></td>
<td style="text-align:left">Lists containers for the application attempt.</td>
</tr>
<tr>
<td style="text-align:left">-status <containerid></containerid></td>
<td style="text-align:left">Prints the status of the container.</td>
</tr>
</tbody>
</table>
<p><code>yarn jar &lt;jar&gt; [mainClass] args...</code></p>
<p>Runs a jar file. </p>
<p><code>yarn logs -applicationId &lt;application ID&gt; [options]</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">COMMAND_OPTIONS</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-applicationId <application id=""></application></td>
<td style="text-align:left">Specifies an application id</td>
</tr>
<tr>
<td style="text-align:left">appOwner <appowner></appowner></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">-containerId <containerid></containerid></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">-nodeAddress <nodeaddress></nodeaddress></td>
<td style="text-align:left">nodename:port</td>
</tr>
</tbody>
</table>
<h4 id="ResourceManager-1"><a href="#ResourceManager-1" class="headerlink" title="ResourceManager"></a>ResourceManager</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">#### NodeManager</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Timeline Server</span><br><span class="line"></span><br><span class="line">Storage and Retrieval of application’s current and historic information in a generic fashion is addressed in YARN through the Timeline Server.</span><br></pre></td></tr></table></figure>
<p>```</p>
<h3 id="REST-API’s"><a href="#REST-API’s" class="headerlink" title="REST API’s"></a>REST API’s</h3><p><code>ResourceManager</code></p>
<ol>
<li>Cluster Information  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/info</code></li>
<li>Cluster Metrics API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/metrics</code></li>
<li>Cluster Scheduler API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/scheduler</code></li>
<li>Cluster Applications API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/apps</code></li>
<li>Cluster Application Statistics API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/appstatistics?states=accepted,running,finished&amp;applicationTypes=mapreduce</code></li>
<li>Cluster Application API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/apps/application_id</code></li>
<li>Cluster Application Attempts API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/apps/application_id/appattempts</code></li>
<li>Cluster Nodes API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/nodes</code></li>
<li>Cluster Node API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/nodes/h2:1235</code></li>
<li>Cluster New Application API  <code>POST http://&lt;rm http address:port&gt;/ws/v1/cluster/apps/new-application</code></li>
<li>Cluster Applications API  <code>POST http://&lt;rm http address:port&gt;/ws/v1/cluster/apps</code></li>
<li>Cluster Application State API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/apps/application_id/state</code></li>
<li>Cluster Application Queue API  <code>GET http://&lt;rm http address:port&gt;/ws/v1/cluster/apps/application_id/queue</code></li>
<li>Cluster Delegation Tokens API  <code>POST http://&lt;rm http address:port&gt;/ws/v1/cluster/delegation-token</code></li>
</ol>
<p><code>NodeManager</code></p>
<ol>
<li>NodeManager Information API  <code>GET http://&lt;nm http address:port&gt;/ws/v1/node/info</code></li>
<li>Applications API  <code>GET http://&lt;nm http address:port&gt;/ws/v1/node/apps</code></li>
<li>Application API  <code>GET http://&lt;nm http address:port&gt;/ws/v1/node/apps/application_id</code></li>
<li>Containers API  <code>GET http://&lt;nm http address:port&gt;/ws/v1/node/containers</code></li>
<li>Container API  <code>GET http://&lt;nm http address:port&gt;/ws/v1/nodes/containers/container_id</code></li>
</ol>
<p><code>Timeline Server</code></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-08-09T16:00:00.000Z"><a href="/2016/08/10/language/java/">2016-08-10</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/10/language/java/">Java</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="Class-Loader"><a href="#Class-Loader" class="headerlink" title="Class Loader"></a>Class Loader</h4><h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><p><a href="http://www.ibm.com/developerworks/cn/java/java-lo-concurrenthashmap/" target="_blank" rel="external"><strong>探索ConcurrentHashMap</strong></a></p>
<p><code>ConcurrentHashMap</code> 是建立在 Java 内存模型基础上的，为了更好的理解 ConcurrentHashMap，首先简单了解一下 Java 的内存模型。</p>
<p>JMM由一些规则组成，这些规则确定线程对内存访问如何排序以及何时可以确保它们对线程是可见的。</p>
<p><code>ConcurrentHashMap</code> 类中包含两个静态内部类 HashEntry 和 Segment。</p>
<p><code>HashEntry</code> 用来封装映射表的键值对；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static final class HashEntry&lt;K,V&gt; &#123; </span><br><span class="line">        final K key;                </span><br><span class="line">        final int hash;             </span><br><span class="line">        volatile V value;           </span><br><span class="line">        final HashEntry&lt;K,V&gt; next;  </span><br><span class="line"></span><br><span class="line">        HashEntry(K key, int hash, HashEntry&lt;K,V&gt; next, V value) &#123; </span><br><span class="line">            this.key = key; </span><br><span class="line">            this.hash = hash; </span><br><span class="line">            this.next = next; </span><br><span class="line">            this.value = value; </span><br><span class="line">        &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><code>Segment</code> 用来充当锁的角色，每个 Segment 对象守护整个散列映射表的若干个桶。每个桶是由若干个 HashEntry 对象链接起来的链表。一个 ConcurrentHashMap 实例中包含由若干个 Segment 对象组成的数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; </span><br><span class="line">        /** </span><br><span class="line">         * 在本 segment 范围内，包含的 HashEntry 元素的个数</span><br><span class="line">         * 该变量被声明为 volatile 型</span><br><span class="line">         */ </span><br><span class="line">        transient volatile int count; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * table 被更新的次数</span><br><span class="line">         */ </span><br><span class="line">        transient int modCount; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * 当 table 中包含的 HashEntry 元素的个数超过本变量值时，触发 table 的再散列</span><br><span class="line">         */ </span><br><span class="line">        transient int threshold; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * table 是由 HashEntry 对象组成的数组</span><br><span class="line">         * 如果散列时发生碰撞，碰撞的 HashEntry 对象就以链表的形式链接成一个链表</span><br><span class="line">         * table 数组的数组成员代表散列映射表的一个桶</span><br><span class="line">         * 每个 table 守护整个 ConcurrentHashMap 包含桶总数的一部分</span><br><span class="line">         * 如果并发级别为 16，table 则守护 ConcurrentHashMap 包含的桶总数的 1/16 </span><br><span class="line">         */ </span><br><span class="line">        transient volatile HashEntry&lt;K,V&gt;[] table; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * 装载因子</span><br><span class="line">         */ </span><br><span class="line">        final float loadFactor; </span><br><span class="line"></span><br><span class="line">        Segment(int initialCapacity, float lf) &#123; </span><br><span class="line">            loadFactor = lf; </span><br><span class="line">            setTable(HashEntry.&lt;K,V&gt;newArray(initialCapacity)); </span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * 设置 table 引用到这个新生成的 HashEntry 数组</span><br><span class="line">         * 只能在持有锁或构造函数中调用本方法</span><br><span class="line">         */ </span><br><span class="line">        void setTable(HashEntry&lt;K,V&gt;[] newTable) &#123; </span><br><span class="line">            // 计算临界阀值为新数组的长度与装载因子的乘积</span><br><span class="line">            threshold = (int)(newTable.length * loadFactor); </span><br><span class="line">            table = newTable; </span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        /** </span><br><span class="line">         * 根据 key 的散列值，找到 table 中对应的那个桶（table 数组的某个数组成员）</span><br><span class="line">         */ </span><br><span class="line">        HashEntry&lt;K,V&gt; getFirst(int hash) &#123; </span><br><span class="line">            HashEntry&lt;K,V&gt;[] tab = table; </span><br><span class="line">            // 把散列值与 table 数组长度减 1 的值相“与”，</span><br><span class="line">           	 // 得到散列值对应的 table 数组的下标</span><br><span class="line">            // 然后返回 table 数组中此下标对应的 HashEntry 元素</span><br><span class="line">            return tab[hash &amp; (tab.length - 1)]; </span><br><span class="line">        &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>HashMap的工作原理</strong></p>
<p>HashMap基于hashing原理。</p>
<p>将键值对传递给<code>put()</code>时，调用键对象的hashCode()方法来计算hashcode，让后找到bucket位置来储存值对象。当<code>get()</code>时，通过键对象的equals()方法找到正确的键值对，然后返回值对象。</p>
<p>HashMap使用<code>链表</code>来解决碰撞问题，当发生碰撞了，对象将会储存在链表的下一个节点中。 HashMap在每个链表节点中储存键值对对象。</p>
<p>当两个不同的键对象的<code>hashcode相同</code>时会发生什么？ 它们会储存在同一个bucket位置的链表中。键对象的equals()方法用来找到键值对。</p>
<p><code>HashTable</code>是synchronized的,但<code>ConcurrentHashMap</code>同步性能更好,因为它仅仅根据同步级别对map的一部分进行上锁。</p>
<hr>
<p><strong>HashMap和Hashtable的区别</strong></p>
<p><code>HashMap</code>和<code>HashTable</code>都实现了Map接口</p>
<p>主要的区别有：线程安全性，同步以及速度。</p>
<ol>
<li>HashMap是非synchronized  HashTable是synchronized2. </li>
<li>HashMap可以接受null</li>
<li>HashMap的Iterator是fail-fast迭代器，而Hashtable的enumerator迭代器不是fail-fast的。所以当有其它线程改变了HashMap的结构，将会抛出ConcurrentModificationException，但迭代器本身的remove()方法移除元素则不会抛出ConcurrentModificationException异常。</li>
<li>HashMap不能保证随着时间的推移Map中的元素次序是不变的。</li>
<li>单线程HashMap性能优于HashTable。</li>
</ol>
<hr>
<p><strong>HashMap和HashSet的区别</strong></p>
<p><code>HashSet</code>实现了Set接口，它不允许集合中有重复的值</p>
<p>首先要确保对象重写equals()和hashCode()方法，以确保set中没有储存相等的对象。</p>
<p><code>HashMap</code>实现了Map接口，Map中不允许重复的键。</p>
<p>Map接口有两个基本的实现，HashMap和TreeMap。</p>
<p><code>TreeMap</code>保存了对象的排列次序，而HashMap则不能。</p>
<p><code>HashMap</code>允许键和值为null。HashMap是非synchronized的。</p>
<hr>
<p>####Java Memory Module</p>
<p>在并发编程中需要处理两个关键问题：</p>
<ol>
<li>线程之间如何通信</li>
<li>线程之间如何同步</li>
</ol>
<p>在命令式编程中，线程之间的通信机制有两种：<code>共享内存和消息传递</code>。</p>
<p><code>共享内存</code>并发模型线程之间共享程序的公共状态，线程之间通过写-读内存中的公共状态来隐式进行通信。</p>
<p><code>消息传递</code>并发模型线程之间没有公共状态，线程之间必须通过明确的发送消息来显式进行通信。</p>
<p><code>同步</code>是指程序用于控制不同线程之间操作发生相对顺序的机制。在共享内存并发模型里，同步是显式进行的。程序员必须显式指定某个方法或某段代码需要在线程之间互斥执行。在消息传递的并发模型里，由于消息的发送必须在消息的接收之前，因此同步是隐式进行的。Java的并发采用的是<code>共享内存模型</code>，Java线程之间的通信总是隐式进行，整个通信过程对程序员完全透明。</p>
<p>Java线程之间的通信由<code>Java内存模型</code>控制，<code>JMM决定一个线程对共享变量的写入何时对另一个线程可见</code>。</p>
<p>从抽象的角度来看，JMM定义了线程和主内存之间的抽象关系：<code>线程之间的共享变量存储在主内存中，每个线程都有一个私有的本地内存，本地内存中存储了该线程以读/写共享变量的副本。</code></p>
<p>本地内存是JMM的一个抽象概念，并不真实存在。它涵盖了缓存，写缓冲区，寄存器以及其他的硬件和编译器优化。</p>
<p><img src="resource/java/main_local_memory.png" alt="main_local_memory"></p>
<p>初始时三个内存x都为0。线程A更新后x值存放在本地内存A中。线程A和线程B需要通信时，线程A首先把自己本地内存中x值刷新到主内存中，主内存中x值变为1。随后，线程B到主内存中去读取线程A更新后x值，此时线程B本地内存x值也变为1。</p>
<p><img src="resource/java/memory_exchange.png" alt="main_local_memory"></p>
<p><strong>重排序</strong></p>
<p>为了提高性能，编译器和处理器常常会对指令做重排序。重排序分三种类型:</p>
<ol>
<li><code>编译器优化的重排序。</code>编译器在不改变单线程程序语义的前提下，可以重新安排语句的执行顺序。</li>
<li><code>指令级并行的重排序。</code>现代处理器采用了指令级并行技术来将多条指令重叠执行。如果不存在数据依赖性，处理器可以改变语句对应机器指令的执行顺序。</li>
<li><code>内存系统的重排序。</code>由于处理器使用缓存和读/写缓冲区，这使得加载和存储操作看上去可能是在乱序执行。</li>
</ol>
<p><img src="resource/java/reordered.png" alt="reordered"></p>
<p><strong>数据竞争与顺序一致性保证</strong></p>
<p><strong>volatile的特性</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class VolatileFeaturesExample &#123;</span><br><span class="line">    volatile long vl = 0L;  //使用volatile声明64位的long型变量</span><br><span class="line"></span><br><span class="line">    public void set(long l) &#123;</span><br><span class="line">        vl = l;   //单个volatile变量的写</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void getAndIncrement () &#123;</span><br><span class="line">        vl++;    //复合（多个）volatile变量的读/写</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public long get() &#123;</span><br><span class="line">        return vl;   //单个volatile变量的读</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class VolatileFeaturesExample &#123;</span><br><span class="line">    long vl = 0L;               // 64位的long型普通变量</span><br><span class="line"></span><br><span class="line">    public synchronized void set(long l) &#123;     //对单个的普通 变量的写用同一个监视器同步</span><br><span class="line">        vl = l;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void getAndIncrement () &#123; //普通方法调用</span><br><span class="line">        long temp = get();           //调用已同步的读方法</span><br><span class="line">        temp += 1L;                  //普通写操作</span><br><span class="line">        set(temp);                   //调用已同步的写方法</span><br><span class="line">    &#125;</span><br><span class="line">    public synchronized long get() &#123; </span><br><span class="line">    //对单个的普通变量的读用同一个监视器同步</span><br><span class="line">        return vl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="resource/java/volatile_happens_before.png" alt="volatile_happens_before"></p>
<p><img src="resource/java/volatile_order.png" alt="volatile_order"></p>
<hr>
<p>Reference :</p>
<ol>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-1" target="_blank" rel="external">深入理解Java内存模型（一）——基础</a></li>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-2" target="_blank" rel="external">深入理解Java内存模型（二）——重排序</a></li>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-3" target="_blank" rel="external">深入理解Java内存模型（三）——顺序一致性</a></li>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-4" target="_blank" rel="external">深入理解Java内存模型（四）——volatile</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzAwNjY4NTQ4MA==&amp;mid=402750371&amp;idx=1&amp;sn=2b621e0b884a7792065fa18c5b767a54&amp;scene=23&amp;srcid=05013sIrNNsBkrCSfGDzPQNu#rd" target="_blank" rel="external">Twitter工程师谈JVM调优</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-31T16:00:00.000Z"><a href="/2016/08/01/distribution/tez/">2016-08-01</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/01/distribution/tez/">Tez</a></h1>
  

    </header>
    <div class="entry">
      
        <h4 id="Tez"><a href="#Tez" class="headerlink" title="Tez"></a>Tez</h4><p>A Framework for YARN-based, Data Processing Applications In Hadoop. </p>
<p>Tez improves the MapReduce paradigm by dramatically improving its speed, while maintaining MapReduce’s ability to scale to petabytes of data. </p>
<p>Apache Tez provides a developer API and framework to write native YARN applications that bridge the spectrum of interactive and batch workloads. It allows those data access applications to work with petabytes of data over thousands nodes. </p>
<p>The Apache Tez component library allows developers to create Hadoop applications that integrate natively with Apache Hadoop YARN and perform well within mixed workload clusters.</p>
<p>Since Tez is extensible and embeddable, it provides the fit-to-purpose freedom to express highly optimized data processing applications, giving them an advantage over end-user-facing engines such as MapReduce and Apache Spark. </p>
<p>Tez also offers a customizable execution architecture that allows users to express complex computations as dataflow graphs, permitting dynamic performance optimizations based on real information about the data and the resources required to process it.</p>
<p><img src="resource/tez/H1H2Tez.png" alt="Tez on Hadoop"></p>
<hr>
<p><strong>DATA PROCESSING API IN APACHE TEZ</strong></p>
<hr>
<p><strong>RUNTIME API IN APACHE TEZ</strong></p>
<hr>
<p><strong>Interface</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line">public abstract class TaskScheduler implements ServicePluginLifecycle &#123;</span><br><span class="line">    /**</span><br><span class="line">     * An entry point for initialization.</span><br><span class="line">     * Order of service setup. Constructor, initialize(), start() - when starting a service.</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize() throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * An entry point for starting the service.</span><br><span class="line">     * Order of service setup. Constructor, initialize(), start() - when starting a service.</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void start() throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Stop the service. This could be invoked at any point, when the service is no longer required -</span><br><span class="line">     * including in case of errors.</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void shutdown() throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The first step of stopping the task scheduler service. This would typically be used to stop</span><br><span class="line">     * allocating new resources. shutdown() will typically be used to unregister from external</span><br><span class="line">     * services - especially YARN for instance, so that the app is not killed</span><br><span class="line">     */</span><br><span class="line">    public void initiateStop() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the &#123;@link TaskSchedulerContext&#125; associated with this instance of the scheduler, which is</span><br><span class="line">     * used to communicate with the rest of the system</span><br><span class="line">     */</span><br><span class="line">    public final TaskSchedulerContext getContext() &#123;</span><br><span class="line">        return taskSchedulerContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the currently available resources from this source</span><br><span class="line">     */</span><br><span class="line">    public abstract Resource getAvailableResources() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the total available resources from this source</span><br><span class="line">     */</span><br><span class="line">    public abstract Resource getTotalResources() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get the number of nodes available from the source</span><br><span class="line">     */</span><br><span class="line">    public abstract int getClusterNodeCount() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Indication to a source that a node has been blacklisted, and should not be used for subsequent</span><br><span class="line">     * allocations.</span><br><span class="line">     */</span><br><span class="line">    public abstract void blacklistNode(NodeId nodeId) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Indication to a source that a node has been un-blacklisted, and can be used from subsequent</span><br><span class="line">     * allocations</span><br><span class="line">     */</span><br><span class="line">    public abstract void unblacklistNode(NodeId nodeId) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * A request to the source to allocate resources for a requesting task, with location information</span><br><span class="line">     * optionally specified</span><br><span class="line">     */</span><br><span class="line">    public abstract void allocateTask(Object task, Resource capability,</span><br><span class="line">                                      String[] hosts, String[] racks, Priority priority,</span><br><span class="line">                                      Object containerSignature, Object clientCookie) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * A request to the source to allocate resources for a requesting task, based on a previously used</span><br><span class="line">     * container</span><br><span class="line">     */</span><br><span class="line">    public abstract void allocateTask(Object task, Resource capability,</span><br><span class="line">                                      ContainerId containerId, Priority priority,</span><br><span class="line">                                      Object containerSignature,</span><br><span class="line">                                      Object clientCookie) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * A request to deallocate a task. This is typically a result of a task completing - with success</span><br><span class="line">     * or failure. It could also be the result of a decision to not run the task, before it is</span><br><span class="line">     * allocated or started.</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * Plugin writers need to de-allocate containers via the context once it&apos;s no longer required, for</span><br><span class="line">     * correct book-keeping</span><br><span class="line">     */</span><br><span class="line">    public abstract boolean deallocateTask(Object task, boolean taskSucceeded,</span><br><span class="line">                                           TaskAttemptEndReason endReason,</span><br><span class="line">                                           @Nullable String diagnostics) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * A request to de-allocate a previously allocated container.</span><br><span class="line">     */</span><br><span class="line">    public abstract Object deallocateContainer(ContainerId containerId) throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Inform the scheduler that it should unregister. This is primarily valid for schedulers which</span><br><span class="line">     * require registration (YARN a.t.m)</span><br><span class="line">     */</span><br><span class="line">    public abstract void setShouldUnregister() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Checks with the scheduler whether it has unregistered.</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    public abstract boolean hasUnregistered() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Indicates to the scheduler that the currently running dag has completed.</span><br><span class="line">     * This can be used to reset dag specific statistics, potentially release resources and prepare</span><br><span class="line">     * for a new DAG.</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    public abstract void dagComplete() throws ServicePluginException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public interface Vertex extends Comparable&lt;Vertex&gt; &#123;</span><br><span class="line"></span><br><span class="line">    TezVertexID getVertexId();</span><br><span class="line"></span><br><span class="line">    public VertexPlan getVertexPlan();</span><br><span class="line"></span><br><span class="line">    int getDistanceFromRoot();</span><br><span class="line"></span><br><span class="line">    LinkedHashMap&lt;String, Integer&gt; getIOIndices();</span><br><span class="line"></span><br><span class="line">    String getName();</span><br><span class="line"></span><br><span class="line">    VertexState getState();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get all the counters of this vertex.</span><br><span class="line">     * @return aggregate task-counters</span><br><span class="line">     */</span><br><span class="line">    TezCounters getAllCounters();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get all the counters of this vertex.</span><br><span class="line">     * @return aggregate task-counters</span><br><span class="line">     */</span><br><span class="line">    TezCounters getCachedCounters();</span><br><span class="line"></span><br><span class="line">    int getMaxTaskConcurrency();</span><br><span class="line"></span><br><span class="line">    Map&lt;TezTaskID, Task&gt; getTasks();</span><br><span class="line"></span><br><span class="line">    Task getTask(TezTaskID taskID);</span><br><span class="line"></span><br><span class="line">    Task getTask(int taskIndex);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; getDiagnostics();</span><br><span class="line"></span><br><span class="line">    int getTotalTasks();</span><br><span class="line"></span><br><span class="line">    int getCompletedTasks();</span><br><span class="line"></span><br><span class="line">    int getSucceededTasks();</span><br><span class="line"></span><br><span class="line">    int getRunningTasks();</span><br><span class="line"></span><br><span class="line">    float getProgress();</span><br><span class="line"></span><br><span class="line">    float getCompletedTaskProgress();</span><br><span class="line"></span><br><span class="line">    ProgressBuilder getVertexProgress();</span><br><span class="line"></span><br><span class="line">    VertexStatusBuilder getVertexStatus(Set&lt;StatusGetOpts&gt; statusOptions);</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    TaskLocationHint getTaskLocationHint(TezTaskID taskID);</span><br><span class="line"></span><br><span class="line">    void setParallelism(int parallelism, VertexLocationHint vertexLocationHint,</span><br><span class="line">                        Map&lt;String, EdgeManagerPluginDescriptor&gt; sourceEdgeManagers,</span><br><span class="line">                        Map&lt;String, InputSpecUpdate&gt; rootInputSpecUpdate, boolean fromVertexManager)</span><br><span class="line">            throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    public void reconfigureVertex(int parallelism,</span><br><span class="line">                                  @Nullable VertexLocationHint locationHint,</span><br><span class="line">                                  @Nullable Map&lt;String, EdgeProperty&gt; sourceEdgeProperties) throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    public void reconfigureVertex(@Nullable Map&lt;String, InputSpecUpdate&gt; rootInputSpecUpdate,</span><br><span class="line">                                  int parallelism,</span><br><span class="line">                                  @Nullable VertexLocationHint locationHint) throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    public void reconfigureVertex(int parallelism,</span><br><span class="line">                                  @Nullable VertexLocationHint locationHint,</span><br><span class="line">                                  @Nullable Map&lt;String, EdgeProperty&gt; sourceEdgeProperties,</span><br><span class="line">                                  @Nullable Map&lt;String, InputSpecUpdate&gt; rootInputSpecUpdate) throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    void setVertexLocationHint(VertexLocationHint vertexLocationHint);</span><br><span class="line"></span><br><span class="line">    void vertexReconfigurationPlanned();</span><br><span class="line"></span><br><span class="line">    void doneReconfiguringVertex();</span><br><span class="line"></span><br><span class="line">    // CHANGE THESE TO LISTS AND MAINTAIN ORDER?</span><br><span class="line">    void setInputVertices(Map&lt;Vertex, Edge&gt; inVertices);</span><br><span class="line"></span><br><span class="line">    void setOutputVertices(Map&lt;Vertex, Edge&gt; outVertices);</span><br><span class="line"></span><br><span class="line">    VertexStatistics getStatistics();</span><br><span class="line"></span><br><span class="line">    Map&lt;Vertex, Edge&gt; getInputVertices();</span><br><span class="line"></span><br><span class="line">    Map&lt;Vertex, Edge&gt; getOutputVertices();</span><br><span class="line"></span><br><span class="line">    Map&lt;String, OutputCommitter&gt; getOutputCommitters();</span><br><span class="line"></span><br><span class="line">    void setAdditionalInputs(List&lt;RootInputLeafOutputProto&gt; inputs);</span><br><span class="line"></span><br><span class="line">    void setAdditionalOutputs(List&lt;RootInputLeafOutputProto&gt; outputs);</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    public Map&lt;String, RootInputLeafOutput&lt;InputDescriptor, InputInitializerDescriptor&gt;&gt;</span><br><span class="line">    getAdditionalInputs();</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    public Map&lt;String, RootInputLeafOutput&lt;OutputDescriptor, OutputCommitterDescriptor&gt;&gt;</span><br><span class="line">    getAdditionalOutputs();</span><br><span class="line"></span><br><span class="line">    List&lt;InputSpec&gt; getInputSpecList(int taskIndex) throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    List&lt;OutputSpec&gt; getOutputSpecList(int taskIndex) throws AMUserCodeException;</span><br><span class="line"></span><br><span class="line">    List&lt;GroupInputSpec&gt; getGroupInputSpecList(int taskIndex);</span><br><span class="line"></span><br><span class="line">    void addSharedOutputs(Set&lt;String&gt; outputs);</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; getSharedOutputs();</span><br><span class="line"></span><br><span class="line">    int getInputVerticesCount();</span><br><span class="line"></span><br><span class="line">    int getOutputVerticesCount();</span><br><span class="line"></span><br><span class="line">    void scheduleTasks(List&lt;ScheduleTaskRequest&gt; tasks);</span><br><span class="line"></span><br><span class="line">    void scheduleSpeculativeTask(TezTaskID taskId);</span><br><span class="line"></span><br><span class="line">    Resource getTaskResource();</span><br><span class="line"></span><br><span class="line">    public TaskAttemptEventInfo getTaskAttemptTezEvents(TezTaskAttemptID attemptID,</span><br><span class="line">                                                        int fromEventId, int nextPreRoutedFromEventId, int maxEvents);</span><br><span class="line"></span><br><span class="line">    void handleSpeculatorEvent(SpeculatorEvent event);</span><br><span class="line"></span><br><span class="line">    ProcessorDescriptor getProcessorDescriptor();</span><br><span class="line"></span><br><span class="line">    public DAG getDAG();</span><br><span class="line"></span><br><span class="line">    VertexTerminationCause getTerminationCause();</span><br><span class="line"></span><br><span class="line">    AppContext getAppContext();</span><br><span class="line"></span><br><span class="line">    String getLogIdentifier();</span><br><span class="line"></span><br><span class="line">    public void incrementFailedTaskAttemptCount();</span><br><span class="line"></span><br><span class="line">    public void incrementKilledTaskAttemptCount();</span><br><span class="line"></span><br><span class="line">    public int getFailedTaskAttemptCount();</span><br><span class="line"></span><br><span class="line">    public int getKilledTaskAttemptCount();</span><br><span class="line"></span><br><span class="line">    public Configuration getConf();</span><br><span class="line"></span><br><span class="line">    public boolean isSpeculationEnabled();</span><br><span class="line"></span><br><span class="line">    public int getTaskSchedulerIdentifier();</span><br><span class="line"></span><br><span class="line">    public int getContainerLauncherIdentifier();</span><br><span class="line"></span><br><span class="line">    public int getTaskCommunicatorIdentifier();</span><br><span class="line"></span><br><span class="line">    public ServicePluginInfo getServicePluginInfo();</span><br><span class="line"></span><br><span class="line">    public long getInitTime();</span><br><span class="line"></span><br><span class="line">    public long getStartTime();</span><br><span class="line"></span><br><span class="line">    public long getFinishTime();</span><br><span class="line"></span><br><span class="line">    void reportTaskStartTime(long taskStartTime);</span><br><span class="line"></span><br><span class="line">    public long getFirstTaskStartTime();</span><br><span class="line"></span><br><span class="line">    public long getLastTaskFinishTime();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public interface Partitioner &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Get partition for given key/value.</span><br><span class="line">     */</span><br><span class="line">    int getPartition(Object key, Object value, int numPartitions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>tez.dag.recovery.enabled</td>
<td>Enable recovery of DAGs. This allows a restarted app master to recover the incomplete DAGs from the previous instance of the app master.</td>
<td>true</td>
</tr>
<tr>
<td>tez.dag.recovery.io.buffer.size</td>
<td></td>
<td>8192</td>
</tr>
<tr>
<td>tez.dag.recovery.flush.interval.secs</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>tez.dag.recovery.max.unflushed.events</td>
<td></td>
<td>100</td>
</tr>
<tr>
<td>tez.task.heartbeat.timeout.check-ms</td>
<td></td>
<td>30000</td>
</tr>
<tr>
<td>tez.task.timeout-ms</td>
<td></td>
<td>300000</td>
</tr>
<tr>
<td>tez.am.acls.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.allow.disabled.timeline-domains</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.client.am.port-range</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.client.am.thread-count</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>tez.am.commit-all-outputs-on-dag-success</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.am.containerlauncher.thread-count-limit</td>
<td></td>
<td>500</td>
</tr>
<tr>
<td>tez.am.container.idle.release-timeout-max.millis</td>
<td></td>
<td>10000</td>
</tr>
<tr>
<td>tez.am.container.idle.release-timeout-min.millis</td>
<td></td>
<td>5000</td>
</tr>
<tr>
<td>tez.am.container.reuse.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.am.container.reuse.locality.delay-allocation-millis</td>
<td></td>
<td>250</td>
</tr>
<tr>
<td>tez.am.container.reuse.non-local-fallback.enabled</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.container.reuse.rack-fallback.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.am.credentials-merge</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.dag.scheduler.class</td>
<td></td>
<td>org.apache.tez.dag.app.dag.impl.DAGSchedulerNaturalOrder</td>
</tr>
<tr>
<td>tez.am.disable.client-version-check</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.inline.task.execution.enabled</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.inline.task.execution.max-tasks</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>tez.am.launch.cluster-default.cmd-opts</td>
<td></td>
<td>-server -Djava.net.preferIPv4Stack=true -Dhadoop.metrics.log.level=WARN</td>
</tr>
<tr>
<td>tez.am.launch.cluster-default.env</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.launch.cmd-opts</td>
<td></td>
<td>-XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps -XX:+UseNUMA -XX:+UseParallelGC</td>
</tr>
<tr>
<td>tez.am.launch.env</td>
<td></td>
<td></td>
</tr>
<tr>
<td>tez.am.legacy.speculative.slowtask.threshold</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.log.level</td>
<td></td>
<td>INFO</td>
</tr>
<tr>
<td>tez.am.max.allowed.time-sec.for-read-error</td>
<td></td>
<td>300</td>
</tr>
<tr>
<td>tez.am.max.app.attempts</td>
<td></td>
<td>2</td>
</tr>
<tr>
<td>tez.am.maxtaskfailures.per.node</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>tez.am.modify-acls</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.node-blacklisting.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.am.node-blacklisting.ignore-threshold-node-percent</td>
<td></td>
<td>33</td>
</tr>
<tr>
<td>tez.am.node-unhealthy-reschedule-tasks</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.preemption.heartbeats-between-preemptions</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>tez.am.preemption.max.wait-time-ms</td>
<td></td>
<td>60000</td>
</tr>
<tr>
<td>tez.am.preemption.percentage</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>tez.am.resource.cpu.vcores</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>tez.am.resource.memory.mb</td>
<td></td>
<td>1024</td>
</tr>
<tr>
<td>tez.am.am-rm.heartbeat.interval-ms.max</td>
<td></td>
<td>1000</td>
</tr>
<tr>
<td>tez.am.session.min.held-containers</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>tez.am.mode.session</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.am.speculation.enabled</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.staging-dir</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.staging.scratch-data.auto-delete</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.am.task.listener.thread-count</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>tez.am.task.max.failed.attempts</td>
<td></td>
<td>4</td>
</tr>
<tr>
<td>tez.am.tez-ui.history-url.template</td>
<td></td>
<td><strong><strong>HISTORY_URL_BASE</strong>/#/tez-app/<strong>APPLICATION_ID</strong></strong></td>
</tr>
<tr>
<td>tez.am.vertex.max-task-concurrency</td>
<td></td>
<td>-1</td>
</tr>
<tr>
<td>tez.am.view-acls</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.am.tez-ui.webservice.enable</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.application.tags</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.aux.uris</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.cancel.delegation.tokens.on.completion</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.client.asynchronous-stop</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.client.diagnostics.wait.timeout-ms</td>
<td></td>
<td>3000</td>
</tr>
<tr>
<td>tez.client.timeout-ms</td>
<td></td>
<td>30000</td>
</tr>
<tr>
<td>tez.java.opts.checker.class</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.java.opts.checker.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.container.max.java.heap.fraction</td>
<td></td>
<td>0.8</td>
</tr>
<tr>
<td>tez.counters.counter-name.max-length</td>
<td></td>
<td>64</td>
</tr>
<tr>
<td>tez.counters.group-name.max-length</td>
<td></td>
<td>256</td>
</tr>
<tr>
<td>tez.counters.max</td>
<td></td>
<td>1200</td>
</tr>
<tr>
<td>tez.counters.max.groups</td>
<td></td>
<td>500</td>
</tr>
<tr>
<td>tez.credentials.path</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.dag.status.pollinterval-ms</td>
<td></td>
<td>500</td>
</tr>
<tr>
<td>tez.generate.debug.artifacts</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.history.logging.service.class</td>
<td></td>
<td>org.apache.tez.dag.history.logging.impl.SimpleHistoryLoggingService</td>
</tr>
<tr>
<td>tez.tez-ui.history-url.base</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.ignore.lib.uris</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.ipc.payload.reserved.bytes</td>
<td></td>
<td>5242880</td>
</tr>
<tr>
<td>tez.lib.uris</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.lib.uris.classpath</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.local.mode</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.queue.name</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.session.am.dag.submit.timeout.secs</td>
<td></td>
<td>300</td>
</tr>
<tr>
<td>tez.session.client.timeout.secs</td>
<td></td>
<td>120</td>
</tr>
<tr>
<td>tez.simple.history.logging.dir</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.simple.history.max.errors</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>tez.task.am.heartbeat.counter.interval-ms.max</td>
<td></td>
<td>4000</td>
</tr>
<tr>
<td>tez.task.am.heartbeat.interval-ms.max</td>
<td></td>
<td>100</td>
</tr>
<tr>
<td>tez.task.generate.counters.per.io</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.task.get-task.sleep.interval-ms.max</td>
<td></td>
<td>200</td>
</tr>
<tr>
<td>tez.task.initialize-processor-first</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.task.initialize-processor-io-serially</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.task.launch.cluster-default.cmd-opts</td>
<td></td>
<td>-server -Djava.net.preferIPv4Stack=true -Dhadoop.metrics.log.level=WARN</td>
</tr>
<tr>
<td>tez.task.launch.cluster-default.env</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task.launch.cmd-opts</td>
<td></td>
<td>-XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps -XX:+UseNUMA -XX:+UseParallelGC</td>
</tr>
<tr>
<td>tez.task.launch.env</td>
<td></td>
<td></td>
</tr>
<tr>
<td>tez.task.log.level</td>
<td></td>
<td>INFO</td>
</tr>
<tr>
<td>tez.task.max-events-per-heartbeat</td>
<td></td>
<td>500</td>
</tr>
<tr>
<td>tez.task.max-event-backlog</td>
<td></td>
<td>10000</td>
</tr>
<tr>
<td>tez.task.progress.stuck.interval-ms</td>
<td></td>
<td>-1</td>
</tr>
<tr>
<td>tez.task.resource.calculator.process-tree.class</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task.resource.cpu.vcores</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>tez.task.resource.memory.mb</td>
<td></td>
<td>1024</td>
</tr>
<tr>
<td>tez.task.scale.memory.additional-reservation.fraction.max</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task.scale.memory.additional-reservation.fraction.per-io</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task.scale.memory.allocator.class</td>
<td></td>
<td>org.apache.tez.runtime.library.resources.WeightedScalingMemoryDistributor</td>
</tr>
<tr>
<td>tez.task.scale.memory.enabled</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.task.scale.memory.reserve-fraction</td>
<td></td>
<td>0.3</td>
</tr>
<tr>
<td>tez.task.scale.memory.ratios</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task-specific.launch.cmd-opts</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task-specific.launch.cmd-opts.list</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.task-specific.log.level</td>
<td></td>
<td>null</td>
</tr>
<tr>
<td>tez.test.minicluster.app.wait.on.shutdown.secs</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>tez.use.cluster.hadoop-libs</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>tez.yarn.ats.acl.domains.auto-create</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>tez.yarn.ats.event.flush.timeout.millis</td>
<td></td>
<td>-1</td>
</tr>
<tr>
<td>tez.yarn.ats.max.events.per.batch</td>
<td></td>
<td>5</td>
</tr>
<tr>
<td>tez.yarn.ats.max.polling.time.per.event.millis</td>
<td></td>
<td>10</td>
</tr>
</tbody>
</table>
<hr>
<p>Reference :</p>
<ol>
<li><a href="http://zh.hortonworks.com/apache/tez/" target="_blank" rel="external">Apache Tez</a></li>
<li><a href="http://zh.hortonworks.com/blog/apache-tez-a-new-chapter-in-hadoop-data-processing/" target="_blank" rel="external">APACHE TEZ: A NEW CHAPTER IN HADOOP DATA PROCESSING</a></li>
<li><a href="http://tez.apache.org/releases/0.8.4/tez-api-javadocs/configs/TezConfiguration.html" target="_blank" rel="external">Tez Configuration</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-31T16:00:00.000Z"><a href="/2016/08/01/algorithms/Tarjan/">2016-08-01</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/01/algorithms/Tarjan/">Tez</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>明确几个概念</strong></p>
<ol>
<li>强连通图 : 在一个强连通图中，任意两个点都通过一定路径互相连通。</li>
<li>强连通分量 : 在一个非强连通图中极大的强连通子图就是该图的强连通分量。</li>
<li></li>
</ol>
<hr>
<h3 id="Tarjan算法"><a href="#Tarjan算法" class="headerlink" title="Tarjan算法"></a>Tarjan算法</h3><p><code>Tarjan算法</code>是一个在图中寻找强连通分量的算法。</p>
<p>此算法以一个有向图作为输入，并按照所在的强连通分量给出其顶点集的一个划分。</p>
<p>图中的每个结点只在一个强连通分量中出现，即使是在有些结点单独构成一个强连通分量的情况下（比如图中出现了树形结构或孤立结点）。</p>
<p>算法的基本思想如下：任选一结点开始进行深度优先搜索（若深度优先搜索结束后仍有未访问的结点，则再从中任选一点再次进行）。</p>
<p>搜索过程中已访问的结点不再访问。搜索树的若干子树构成了图的强连通分量。</p>
<p>结点按照被访问的顺序存入栈中。</p>
<p>从搜索树的子树返回至一个结点时，检查该结点是否是某一强连通分量的根结点（见下）并将其从栈中删除。</p>
<p>如果某结点是强连通分量的根，则在它之前出栈且还不属于其他强连通分量的结点构成了该结点所在的强连通分量。</p>
<p>算法的关键在于如何判定某结点是否是强连通分量的根。</p>
<p>注意“<strong>强连通分量的根</strong>”这一说法仅针对此算法，事实上强连通分量是没有特定的“根”的。</p>
<p>在这里根结点指深度优先搜索时强连通分量中首个被访问的结点。</p>
<p>为找到根结点，我们给每个结点v一个深度优先搜索标号v.index，表示它是第几个被访问的结点。</p>
<p>此外，每个结点v还有一个值v.lowlink，表示从v出发经有向边可到达的所有结点中最小的index。</p>
<p>显然v.lowlink总是不大于v.index，且当从v出发经有向边不能到达其他结点时，这两个值相等。</p>
<p>v.lowlink在深度优先搜索的过程中求得，v是强连通分量的根当且仅当v.lowlink = v.index。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">algorithm tarjan is</span><br><span class="line">  input: 图 G = (V, E)</span><br><span class="line">  output: 以所在的强连通分量划分的顶点集</span><br><span class="line"></span><br><span class="line">  index := 0</span><br><span class="line">  S := empty    // 置栈为空</span><br><span class="line">  for each v in V do</span><br><span class="line">    if (v.index is undefined)</span><br><span class="line">      strongconnect(v)</span><br><span class="line">    end if</span><br><span class="line"></span><br><span class="line">  function strongconnect(v)</span><br><span class="line">    // 将未使用的最小index值作为结点v的index</span><br><span class="line">    v.index := index</span><br><span class="line">    v.lowlink := index</span><br><span class="line">    index := index + 1</span><br><span class="line">    S.push(v)</span><br><span class="line"></span><br><span class="line">    // 考虑v的后继结点</span><br><span class="line">    for each (v, w) in E do</span><br><span class="line">      if (w.index is undefined) then</span><br><span class="line">        // 后继结点w未访问，递归调用</span><br><span class="line">        strongconnect(w)</span><br><span class="line">        v.lowlink := min(v.lowlink, w.lowlink)</span><br><span class="line">      else if (w is in S) then</span><br><span class="line">        // w已在栈S中，亦即在当前强连通分量中</span><br><span class="line">        v.lowlink := min(v.lowlink, w.index)</span><br><span class="line">      end if</span><br><span class="line"></span><br><span class="line">    // 若v是根则出栈，并求得一个强连通分量</span><br><span class="line">    if (v.lowlink = v.index) then</span><br><span class="line">      start a new strongly connected component</span><br><span class="line">      repeat</span><br><span class="line">        w := S.pop()</span><br><span class="line">        add w to current strongly connected component</span><br><span class="line">      until (w = v)</span><br><span class="line">      output the current strongly connected component</span><br><span class="line">    end if</span><br><span class="line">  end function</span><br></pre></td></tr></table></figure>
<hr>
<p>Reference :</p>
<ol>
<li><a href="https://zh.wikipedia.org/zh-cn/Tarjan%E7%AE%97%E6%B3%95" target="_blank" rel="external">Wiki Tarjan算法</a></li>
<li><a href="https://www.byvoid.com/blog/scc-tarjan" target="_blank" rel="external">有向图强连通分量的Tarjan算法</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-24T16:00:00.000Z"><a href="/2016/07/25/distribution/hive/">2016-07-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/25/distribution/hive/">Hive</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>Hive</strong></p>
<p>order by<br>order by 会对输入做全局排序，因此只有一个reducer（多个reducer无法保证全局有序）<br>只有一个reducer，会导致当输入规模较大时，需要较长的计算时间。</p>
<p>set hive.mapred.mode=nonstrict; (default value / 默认值)</p>
<p>set hive.mapred.mode=strict;</p>
<p>order by 和数据库中的Order by 功能一致，按照某一项 &amp; 几项 排序输出。</p>
<p>与数据库中 order by 的区别在于在hive.mapred.mode = strict 模式下 必须指定 limit 否则执行会报错。</p>
<p>hive&gt; select * from test order by id;     </p>
<p>FAILED: Error in semantic analysis: 1:28 In strict mode, if ORDER BY is specified, LIMIT must also be specified. Error encountered near token ‘id’</p>
<p>原因： 在order by 状态下所有数据会到一台服务器进行reduce操作也即只有一个reduce，如果在数据量大的情况下会出现无法输出结果的情况，如果进行 limit n ，那只有  n * map number 条记录而已。只有一个reduce也可以处理过来。</p>
<p>sort by<br>sort by不是全局排序，其在数据进入reducer前完成排序.</p>
<p>因此，如果用sort by进行排序，并且设置mapred.reduce.tasks&gt;1， 则sort by只保证每个reducer的输出有序，不保证全局有序。</p>
<p>sort by 不受 hive.mapred.mode 是否为strict ,nostrict 的影响</p>
<p>sort by 的数据只能保证在同一reduce中的数据可以按指定字段排序。</p>
<p>使用sort by 你可以指定执行的reduce 个数 （set mapred.reduce.tasks=<number>）,对输出的数据再执行归并排序，即可以得到全部结果。</number></p>
<p>注意：可以用limit子句大大减少数据量。使用limit n后，传输到reduce端（单机）的数据记录数就减少到n* （map个数）。否则由于数据过大可能出不了结果。</p>
<p>distribute by<br>按照指定的字段对数据进行划分到不同的输出reduce  / 文件中。</p>
<p>insert overwrite local directory ‘/home/hadoop/out’ select * from test order by name distribute by length(name);  </p>
<p>此方法会根据name的长度划分到不同的reduce中，最终输出到不同的文件中。 </p>
<p>length 是内建函数，也可以指定其他的函数或这使用自定义函数。</p>
<p>Cluster By<br>cluster by 除了具有 distribute by 的功能外还兼具 sort by 的功能。 </p>
<p>但是排序只能是倒序排序，不能指定排序规则为asc 或者desc。</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>hive.exec.stagingdir</td>
<td></td>
<td></td>
</tr>
<tr>
<td>hive.exec.scratchdir</td>
<td></td>
<td></td>
</tr>
<tr>
<td>hive.direct.sql.max.query.length</td>
<td>The maximum size of a query string .</td>
<td>100 KB</td>
</tr>
<tr>
<td>hive.direct.sql.max.elements.in.clause</td>
<td>The maximum number of values in a IN clause. Once exceeded, it will be broken into multiple OR separated IN clauses.</td>
<td>1000</td>
</tr>
<tr>
<td>hive.direct.sql.max.elements.values.clause</td>
<td>The maximum number of values in a VALUES clause for INSERT statement.</td>
<td>1000</td>
</tr>
<tr>
<td>hive.table.parameters.default</td>
<td>Default property values for newly created tables</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>hive.session.id</td>
<td></td>
<td></td>
</tr>
<tr>
<td>hive.session.silent</td>
<td></td>
<td>false</td>
</tr>
<tr>
<td>hive.session.history.enabled</td>
<td>Whether to log Hive query, query plan, runtime statistics etc.</td>
<td>false</td>
</tr>
<tr>
<td>hive.query.string</td>
<td>Query being executed</td>
<td></td>
</tr>
<tr>
<td>hive.query.id</td>
<td>ID for query being executed</td>
<td></td>
</tr>
<tr>
<td>hive.jobname.length</td>
<td>max jobname length</td>
<td>50</td>
</tr>
<tr>
<td>hive.alias</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>hive.map.aggr</td>
<td>Whether to use map-side aggregation in Hive Group By queries</td>
<td>true</td>
</tr>
<tr>
<td>hive.groupby.skewindata</td>
<td>Whether there is skew in data to optimize group by queries</td>
<td>false</td>
</tr>
<tr>
<td>hive.join.emit.interval</td>
<td>How many rows in the right-most join operand Hive should buffer before emitting the join result.</td>
<td>1000</td>
</tr>
<tr>
<td>hive.join.cache.size</td>
<td>How many rows in the joining tables (except the streaming table) should be cached in memory.</td>
<td>25000</td>
</tr>
<tr>
<td>hive.mapjoin.bucket.cache.size</td>
<td></td>
<td>100</td>
</tr>
<tr>
<td>hive.mapjoin.optimized.hashtable</td>
<td>Whether Hive should use memory-optimized hash table for MapJoin. Only works on Tez and Spark, because memory-optimized hashtable cannot be serialized.</td>
<td>true</td>
</tr>
<tr>
<td>hive.groupby.mapaggr.checkinterval</td>
<td>Number of rows after which size of the grouping keys/aggregation classes is performed</td>
<td>100000</td>
</tr>
<tr>
<td>hive.map.aggr.hash.percentmemory</td>
<td>Portion of total memory to be used by map-side group aggregation hash table</td>
<td>0.5</td>
</tr>
<tr>
<td>hive.mapjoin.followby.map.aggr.hash.percentmemory</td>
<td>Portion of total memory to be used by map-side group aggregation hash table, when this group by is followed by map join</td>
<td>0.3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>hive.heartbeat.interval</td>
<td>Send a heartbeat after this interval - used by mapjoin and filter operators</td>
<td>1000</td>
</tr>
<tr>
<td>hive.limit.row.max.size</td>
<td>When trying a smaller subset of data for simple LIMIT, how much size we need to guarantee each row to have at least.</td>
<td>100000</td>
</tr>
<tr>
<td>hive.limit.optimize.limit.file</td>
<td>When trying a smaller subset of data for simple LIMIT, maximum number of files we can sample.</td>
<td>10</td>
</tr>
<tr>
<td>hive.limit.optimize.enable</td>
<td>Whether to enable to optimization to trying a smaller subset of data for simple LIMIT first.</td>
<td>false</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-19T16:00:00.000Z"><a href="/2016/07/20/language/node/">2016-07-20</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/20/language/node/">Node</a></h1>
  

    </header>
    <div class="entry">
      
        
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Vorherige Seite</a>
  
  
    <a href="/page/4/" class="alignright next">Nächste Seite</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Suche">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Kategorien</h3>
  <ul class="entry">
  
    <li><a href="/categories/Algorithms/">Algorithms</a><small>2</small></li>
  
    <li><a href="/categories/Design/">Design</a><small>1</small></li>
  
    <li><a href="/categories/Distributed/">Distributed</a><small>10</small></li>
  
    <li><a href="/categories/Language/">Language</a><small>6</small></li>
  
    <li><a href="/categories/Machine-Learning/">Machine Learning</a><small>1</small></li>
  
    <li><a href="/categories/Mathematics/">Mathematics</a><small>1</small></li>
  
    <li><a href="/categories/Network/">Network</a><small>2</small></li>
  
    <li><a href="/categories/OP/">OP</a><small>1</small></li>
  
    <li><a href="/categories/Psychology/">Psychology</a><small>1</small></li>
  
    <li><a href="/categories/Storage/">Storage</a><small>2</small></li>
  
    <li><a href="/categories/live/">live</a><small>4</small></li>
  
    <li><a href="/categories/machine-learning/">machine_learning</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Algorithms/">Algorithms</a><small>1</small></li>
  
    <li><a href="/tags/Alluxio/">Alluxio</a><small>1</small></li>
  
    <li><a href="/tags/Clojure/">Clojure</a><small>1</small></li>
  
    <li><a href="/tags/Design/">Design</a><small>1</small></li>
  
    <li><a href="/tags/Hadoop/">Hadoop</a><small>5</small></li>
  
    <li><a href="/tags/JVM/">JVM</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>1</small></li>
  
    <li><a href="/tags/Machine-Learning/">Machine Learning</a><small>1</small></li>
  
    <li><a href="/tags/Mathematics/">Mathematics</a><small>1</small></li>
  
    <li><a href="/tags/Mesos/">Mesos</a><small>1</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>1</small></li>
  
    <li><a href="/tags/Network/">Network</a><small>2</small></li>
  
    <li><a href="/tags/Node/">Node</a><small>1</small></li>
  
    <li><a href="/tags/Politics/">Politics</a><small>1</small></li>
  
    <li><a href="/tags/Psychology/">Psychology</a><small>1</small></li>
  
    <li><a href="/tags/RedBlackTree/">RedBlackTree</a><small>1</small></li>
  
    <li><a href="/tags/RocksDB/">RocksDB</a><small>1</small></li>
  
    <li><a href="/tags/Scala/">Scala</a><small>1</small></li>
  
    <li><a href="/tags/Streaming-Process/">Streaming Process</a><small>1</small></li>
  
    <li><a href="/tags/TensorFlow/">TensorFlow</a><small>1</small></li>
  
    <li><a href="/tags/ZooKeeper/">ZooKeeper</a><small>1</small></li>
  
    <li><a href="/tags/coffee/">coffee</a><small>1</small></li>
  
    <li><a href="/tags/fitness/">fitness</a><small>1</small></li>
  
    <li><a href="/tags/game/">game</a><small>1</small></li>
  
    <li><a href="/tags/spark/">spark</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 Darion Yaphet
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
